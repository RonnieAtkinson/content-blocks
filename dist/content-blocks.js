(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var e=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,a;return n=e,a=[{key:"removeClassFromChildren",value:function(t,e,n){if(!t||!e)throw new Error("To remove classes from children a required parameter is missing");for(var a=t.getElementsByClassName(e);a[0];)a[0].classList.remove(n||e)}},{key:"targetHasClass",value:function(t,e){if(!t||!e)throw new Error("To check if a target has a class a required parameter is missing");if(e.some((function(e){return t.classList.contains(e)})))return t.classList}}],null&&t(n.prototype,null),a&&t(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}();function n(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,a;return e=t,a=[{key:"isNullUndefindedEmpty",value:function(t){return null==t||""===t}}],null&&n(e.prototype,null),a&&n(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var s=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e)throw new Error("The kind of element you want to create is required as the first parameter");this.el=document.createElement(e)}var e,n;return e=t,(n=[{key:"addAttributes",value:function(t){if(!t)throw new Error("No attributes were provided");if("object"!=r(t))throw new Error("Attributes need to be passed as an object, eg: { name: 'foo', id: 'bar' }");for(var e in t)if(!a.isNullUndefindedEmpty(t[e]))if("object"==r(t[e])){for(var n in t[e])if(!a.isNullUndefindedEmpty(t[e][n]))if("classList"===e)this.el[e].add(t[e][n]);else{if("dataset"!==e)throw new Error("An object was provided as the value of '".concat(e,"'. Objects can only be used with 'classList' or 'dataset'."));this.el[e][n]=t[e][n]}}else this.el[e]=t[e];return this}},{key:"appendTo",value:function(t){return t.appendChild(this.el),this}},{key:"insertBeforeEl",value:function(t){return t.parentElement.insertBefore(this.el,t),this}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function i(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=c(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){i=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw o}}}}function c(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var g={"block:wrapper":"content-blocks-wrapper","block:parent":"content-blocks","block:single":"content-blocks__single","form:control":"form-control","button:wrapper":"content-block-buttons","button:addBlock":"bt-add-group","button:removeBlock":"bt-remove-group","button:addDynamic":"bt-add","button:removeDynamic":"bt-remove","button:toggleDrag":"bt-toggle-draggable","button:toggleDrag:active":"active","drag:droppable":"droppable"},y={"button:removeBlock":"Remove","button:addDynamic":"Add","button:removeDynamic":"Remove"},v={initialDragState:!1},k={intro:{display:"Introduction",formControls:{content:{label:"Content",element:{node:"textarea",attributes:{}}}}},link:{display:"Link",variations:{internal:{display:"Internal"},external:{display:"External"}},formControls:{variation:{label:"variation",element:{node:"select"}},linkText:{label:"Link Text",element:{node:"input",attributes:{type:"text",placeholder:"test"}}},linkUrl:{label:"Link URL",element:{node:"input",attributes:{type:"text"}}}}},paragraph:{display:"Paragraph",formControls:{content:{label:"Content",element:{node:"textarea",attributes:{}}}}},heading:{display:"Heading",variations:{h2:{display:"H2"},h3:{display:"H3"},h4:{display:"H4"},h5:{display:"H5"},h6:{display:"H6"}},formControls:{variation:{label:"variation",element:{node:"select",attributes:{}}},content:{label:"Content",element:{node:"input",attributes:{type:"text"}}}}},infoBox:{display:"Information Box",variations:{positive:{display:"Positive"},negative:{display:"Negative"},neutral:{display:"Neutral"}},formControls:{variation:{label:"variation",element:{node:"select",attributes:{}}},title:{label:"Title",element:{node:"input",attributes:{type:"text"}}},paragraph:{label:"Paragraph",dynamic:!0,attributes:{data:{el:"textarea",name:"content"}}}}},code:{display:"Code Block",variations:{html:{display:"HTML"},javascript:{display:"Javascript"}},formControls:{variation:{label:"Language",element:{node:"select",attributes:{}}},content:{label:"Content",element:{node:"textarea",attributes:{}}}}}},C=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(m(this,t),!e||"FORM"!=e.nodeName)throw new Error("A valid form node is required to connect a form");if(!n||"object"!=h(n))throw new Error("Content groups must be passed as an object. Currently ".concat("undefined"==typeof contentGroups?"undefined":h(contentGroups)));this.ACTION_ADD="add",this.ACTION_REMOVE="remove",this.formEl=e,this.contentGroups=f(f({},k),n),this.options=f(f(f({},v),a),{},{text:f(f({},y),a.text||{}),classes:f(f({},g),a.classes||{}),exclude:{defaultBlocks:(a.exclude||[]).defaultBlocks||[]}}),this.options.exclude.defaultBlocks.length>0&&this.excludeDefaultBlocks(),this.contentBlocksWrapperEl=this.formEl.querySelector(".".concat(this.getClassNameFor("block:wrapper"))),this.contentBlocksParentEl=this.contentBlocksWrapperEl.querySelector(".".concat(this.getClassNameFor("block:parent"))),this.contentBlocksButtonWrapperEl=this.contentBlocksWrapperEl.querySelector(".".concat(this.getClassNameFor("button:wrapper"))),this.toggleDragEl=this.contentBlocksParentEl.querySelector(".".concat(this.getClassNameFor("button:toggleDrag"))),this.contentBlocksLNL=this.contentBlocksParentEl.getElementsByClassName(this.getClassNameFor("block:single")),this.dragState=this.options.initialDragState,this.render()}var n,r;return n=t,(r=[{key:"excludeDefaultBlocks",value:function(){var t,e=l(this.options.exclude.defaultBlocks);try{for(e.s();!(t=e.n()).done;){var n=t.value;delete this.contentGroups[n]}}catch(t){e.e(t)}finally{e.f()}return this}},{key:"getClassNameFor",value:function(t){return this.getClassNamesFor(t)[0]}},{key:"getClassNamesFor",value:function(t){var e=this.options.classes[t];return Array.isArray(e)?e:"string"==typeof e?[e]:[]}},{key:"generateName",value:function(t,e,n){if(!t||!e)throw new Error("An index and key are required to generate a name");var a="postContent[a".concat(t,"][").concat(e,"]");return!0===n?a+"[]":a}},{key:"addDynamicButtons",value:function(t){return new s("button").addAttributes({type:"button",textContent:this.options.text["button:addDynamic"],classList:i(this.getClassNamesFor("button:addDynamic"))}).appendTo(t),new s("button").addAttributes({type:"button",textContent:this.options.text["button:removeDynamic"],classList:i(this.getClassNamesFor("button:removeDynamic")),disabled:!0}).appendTo(t),this}},{key:"toggleDynamicRemoveButton",value:function(t,e,n){if(!t||a.isNullUndefindedEmpty(e))throw new Error("To toggle the remove button a required parameter is missing");if(![this.ACTION_ADD,this.ACTION_REMOVE].includes(n))throw new Error("To toggle the remove button the action parmeter needs to be 'add' or 'remove'. ".concat(n," was provided."));var r=0===e;n===this.ACTION_ADD&&e>1||n===this.ACTION_REMOVE&&!r||(t.disabled=r)}},{key:"addDynamicElement",value:function(t,e,n){var a=t.closest(".".concat(this.getClassNameFor("block:single"))).dataset.id,r=t.closest(".".concat(this.getClassNameFor("form:control"))).dataset,o=r.name,i=r.type,l={name:this.generateName(a,o,!0)};return i&&(l.type=i),new s(e).addAttributes(l).insertBeforeEl(t),this.toggleDynamicRemoveButton(t.nextElementSibling,n.length,this.ACTION_ADD),this}},{key:"removeDynamicElement",value:function(t,e){var n=e.length;if(0!==n)return e[n-1].parentElement.removeChild(e[n-1]),this.toggleDynamicRemoveButton(t,e.length,this.ACTION_ADD),this}},{key:"addContentButtons",value:function(){for(var t in this.contentGroups)new s("button").addAttributes({type:"button",textContent:this.contentGroups[t].display,classList:[].concat(i(this.getClassNamesFor("button:addBlock")),["".concat(this.getClassNameFor("button:addBlock"),"--").concat(t)]),dataset:{group:t}}).appendTo(this.contentBlocksButtonWrapperEl)}},{key:"addContentBlockFormControls",value:function(t,e,n,a){if("object"!=h(e)||!Object.keys(e).length)throw new Error("No form controls were passed");for(var r in e){var o=!!(e[r].element||{}).node,l="variation"===r&&!!Object.keys(n||{}).length&&o,c=!!(e[r]||{}).dynamic,d=new s(c?"fieldset":"div").addAttributes({classList:[].concat(i(this.getClassNamesFor("form:control")),["".concat(this.getClassNameFor("form:control"),"--").concat(r)]),dataset:(e[r].attributes||{}).data}).appendTo(t).el,u=void 0;if(c)new s("legend").addAttributes({textContent:(e[r]||{}).label}).appendTo(d),this.addDynamicButtons(d);else if(new s("label").addAttributes({textContent:(e[r]||{}).label,htmlFor:"test"}).appendTo(d),o&&(u=new s(e[r].element.node).addAttributes(f(f({},e[r].element.attributes||{}),{},{name:this.generateName(a,r)})).appendTo(d).el),l)for(var p in n)new s("option").addAttributes({value:p,textContent:n[p].display}).appendTo(u)}}},{key:"addContentBlock",value:function(t){if(!t)throw new Error("No content type provided for this block");var e=this.contentGroups[t]||{},n=e.display,a=e.formControls,r=e.variations;if(!n||!a)throw new Error("Invalid options provided for the ".concat(t," content block"));var o=this.contentBlocksLNL.length+1,l=new s("fieldset").addAttributes({draggable:this.dragState,classList:[].concat(i(this.getClassNamesFor("block:single")),["".concat(this.getClassNameFor("block:single"),"--").concat(t)]),dataset:{id:o}}).el;new s("legend").addAttributes({textContent:n}).appendTo(l),new s("button").addAttributes({type:"button",textContent:this.options.text["button:removeBlock"],classList:i(this.getClassNamesFor("button:removeBlock"))}).appendTo(l);var c=new s("div").addAttributes({classList:[].concat(i(this.getClassNamesFor("form:control")),["".concat(this.getClassNameFor("form:control"),"--type")])}).appendTo(l).el;new s("input").addAttributes({type:"hidden",value:t,name:this.generateName(o,"type")}).appendTo(c);var d=new s("fieldset").addAttributes({classList:[].concat(i(this.getClassNamesFor("form:control")),["".concat(this.getClassNameFor("form:control"),"--class")]),dataset:{el:"input",type:"text",name:"class"}}).appendTo(l).el;new s("legend").addAttributes({textContent:"Classes"}).appendTo(d),this.addDynamicButtons(d),this.addContentBlockFormControls(l,a,r,o),this.contentBlocksParentEl.appendChild(l),this.isDragAllowed()&&(this.toggleDragEl.disabled=!1)}},{key:"updateIndexInNames",value:function(t,e){var n,a=l(t.querySelectorAll('[name^="postContent"]'));try{for(a.s();!(n=a.n()).done;){var r=n.value;r.name=r.name.replace(/(\d+)+/g,(function(t,n){return e}))}}catch(t){a.e(t)}finally{a.f()}}},{key:"updateWrapperIndexes",value:function(){var t,e=1,n=l(this.contentBlocksLNL);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.dataset.id=e,this.updateIndexInNames(a,e),e++}}catch(t){n.e(t)}finally{n.f()}}},{key:"removeContentBlock",value:function(t){t&&(t.remove(),this.updateWrapperIndexes(),this.isDragAllowed()||this.disableDrag())}},{key:"isDragAllowed",value:function(){return this.contentBlocksLNL.length>1}},{key:"disableDrag",value:function(){this.dragState=!1,this.toggleDragEl.disabled=!0,this.toggleDragEl.classList.remove(this.getClassNameFor("button:toggleDrag:active"));var t,e=l(this.contentBlocksLNL);try{for(e.s();!(t=e.n()).done;)t.value.draggable=!1}catch(t){e.e(t)}finally{e.f()}}},{key:"handleDragToggle",value:function(t){if(this.isDragAllowed()){this.toggleDragEl.classList.toggle(this.getClassNameFor("button:toggleDrag:active")),this.dragState=!this.contentBlocksLNL[0].draggable;var e,n=l(this.contentBlocksLNL);try{for(n.s();!(e=n.n()).done;)e.value.draggable=this.dragState}catch(t){n.e(t)}finally{n.f()}}}},{key:"handleDragStart",value:function(t){var e=t.target.closest(".".concat(this.getClassNameFor("block:single")));e.draggable&&(t.dataTransfer.setData("text/html",e.dataset.id),t.dataTransfer.effectAllowed="move")}},{key:"handleDragEnd",value:function(t){"none"===t.dataTransfer.dropEffect&&e.removeClassFromChildren(this.contentBlocksParentEl,this.getClassNameFor("drag:droppable")),this.updateWrapperIndexes()}},{key:"handleDragEnter",value:function(t){var e=t.target.closest(".".concat(this.getClassNameFor("block:single")));e&&"text/html"===t.dataTransfer.types[0]&&(e.classList.add(this.getClassNameFor("drag:droppable")),t.preventDefault())}},{key:"handleDragOver",value:function(t){"text/html"===t.dataTransfer.types[0]&&t.preventDefault()}},{key:"handleDragLeave",value:function(t){var n=t.target.closest(".".concat(this.getClassNameFor("block:single")));n&&t.relatedTarget&&t.relatedTarget.closest(".".concat(this.getClassNameFor("block:single")))!==n&&e.removeClassFromChildren(this.contentBlocksParentEl,this.getClassNameFor("drag:droppable"))}},{key:"handleDragDrop",value:function(t){var e=t.target.closest(".".concat(this.getClassNameFor("block:single"))),n=t.dataTransfer.getData("text/html"),a=document.querySelector("[data-id='".concat(n,"']"));e&&e.parentElement&&(e.parentElement.insertBefore(a,e),e.classList.remove(this.getClassNameFor("drag:droppable")))}},{key:"handleFormClicks",value:function(t){var n=t.target;if("BUTTON"==n.nodeName&&"button"===n.type){var a,r;if(e.targetHasClass(n,[this.getClassNameFor("button:addDynamic"),this.getClassNameFor("button:removeDynamic")])){if(!(r=n.closest(".".concat(this.getClassNameFor("form:control"))).dataset.el))throw new Error("No data-el on the parent element");a=n.parentElement.getElementsByTagName(r)}switch(n.classList){case e.targetHasClass(n,i(this.getClassNamesFor("button:addDynamic"))):this.addDynamicElement(n,r,a);break;case e.targetHasClass(n,i(this.getClassNamesFor("button:removeDynamic"))):this.removeDynamicElement(n,a);break;case e.targetHasClass(n,i(this.getClassNamesFor("button:addBlock"))):this.addContentBlock(n.dataset.group);break;case e.targetHasClass(n,i(this.getClassNamesFor("button:removeBlock"))):this.removeContentBlock(n.parentElement);break;case e.targetHasClass(n,i(this.getClassNamesFor("button:toggleDrag"))):this.handleDragToggle()}return this}}},{key:"formListener",value:function(){return this.contentBlocksWrapperEl.addEventListener("click",this.handleFormClicks.bind(this)),this.contentBlocksParentEl.addEventListener("dragstart",this.handleDragStart.bind(this)),this.contentBlocksParentEl.addEventListener("dragend",this.handleDragEnd.bind(this)),this.contentBlocksParentEl.addEventListener("dragenter",this.handleDragEnter.bind(this)),this.contentBlocksParentEl.addEventListener("dragover",this.handleDragOver.bind(this)),this.contentBlocksParentEl.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.contentBlocksParentEl.addEventListener("drop",this.handleDragDrop.bind(this)),this}},{key:"render",value:function(){return this.addContentButtons(),this.formListener(),this}}])&&b(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function w(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"init",value:function(){var t=document.querySelector("form");new C(t,{list:{display:"List",formControls:{content:{label:"Check me",element:{node:"input",attributes:{type:"checkbox"}}}}}},{exclude:{defaultBlocks:["link"]}})}}],null&&w(e.prototype,null),n&&w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t})().init()})();